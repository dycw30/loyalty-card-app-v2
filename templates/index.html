<!DOCTYPE html>
<html>
<head>
    <title>Loyalty Card App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 10px; }
        h1, h2 { text-align: center; }
        form { background: #f4f4f4; padding: 15px; border-radius: 5px; }
        input, select { width: 100%; padding: 8px; margin: 6px 0; }
        button { width: 100%; padding: 10px; background: #333; color: white; border: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        tr:nth-child(even) { background: #f9f9f9; }
        .message { color: green; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Caf√© Loyalty Dashboard</h1>

    <form method="post">
        <label>Unique ID:</label>
        <input type="text" name="unique_id" required>

        <label>Customer Name (optional):</label>
        <input type="text" name="customer_name">

        <label>Phone Number (optional):</label>
        <input type="text" name="phone_number">

        <label>Drink Type:</label>
        <select name="drink">
            <option value="">N/A</option>
            {% for drink in drinks %}
            <option value="{{ drink }}">{{ drink }}</option>
            {% endfor %}
        </select>

        <label>Quantity of Drinks:</label>
        <input type="number" name="quantity" min="0" value="0">

        <label>Redeem Tokens:</label>
        <input type="number" name="redeem" min="0" value="0">

        <button type="submit">Submit Order</button>
    </form>

    {% if message %}
    <p class="message">{{ message }}</p>
    {% endif %}

    {% if summary %}
    <h2>Summary for {{ summary.unique_id }}</h2>
    <table>
        <tr><th>Total Orders</th><th>Tokens Earned</th><th>Redeemed</th><th>Balance</th></tr>
        <tr>
            <td>{{ summary.total_orders }}</td>
            <td>{{ summary.tokens_earned }}</td>
            <td>{{ summary.redeemed }}</td>
            <td>{{ summary.balance }}</td>
        </tr>
    </table>

    <h3>Recent Orders</h3>
    <table>
        <tr><th>Date</th><th>Drink</th><th>Qty</th><th>Tokens</th><th>Redeemed</th></tr>
        {% for order in recent_orders %}
        <tr>
            <td>{{ order.date }}</td>
            <td>{{ order.drink_type }}</td>
            <td>{{ order.quantity }}</td>
            <td>{{ order.tokens }}</td>
            <td>{{ order.redeemed }}</td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    <h2>All Customers Summary</h2>
    <table>
        <tr>
            <th>Unique ID</th>
            <th>Name</th>
            <th>Phone</th>
            <th>Total Orders</th>
            <th>Tokens</th>
            <th>Redeemed</th>
            <th>Balance</th>
        </tr>
        {% for row in all_summary %}
        <tr>
            <td>{{ row.unique_id }}</td>
            <td>{{ row.customer_name }}</td>
            <td>{{ row.phone_number }}</td>
            <td>{{ row.total_orders }}</td>
            <td>{{ row.tokens_earned }}</td>
            <td>{{ row.redeemed }}</td>
            <td>{{ row.balance }}</td>
        </tr>
        {% endfor %}
    </table>

    <div style="text-align:center; margin-top:20px;">
        <a href="/export"><button style="background:green;">Export to Excel</button></a>
        <a href="/logout"><button>Logout</button></a>
    </div>
</body>
</html>
