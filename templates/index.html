<!DOCTYPE html>
<html>
<head>
    <title>Barista Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script>
        async function fetchCustomerNames() {
            const id = document.getElementById('unique_id').value;
            const response = await fetch('/lookup', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'unique_id=' + encodeURIComponent(id)
            });
            const data = await response.json();

            const dropdown = document.getElementById('name_dropdown');
            const nameField = document.getElementById('custom_name');

            dropdown.innerHTML = '';
            if (data.names.length > 0) {
                dropdown.style.display = 'block';
                nameField.style.display = 'none';
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = '-- Select Name --';
                dropdown.appendChild(defaultOption);
                data.names.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    dropdown.appendChild(option);
                });
            } else {
                dropdown.style.display = 'none';
                nameField.style.display = 'block';
            }
        }

        function toggleNameInput() {
            const dropdown = document.getElementById('name_dropdown');
            const nameField = document.getElementById('custom_name');
            if (dropdown.value === '') {
                nameField.style.display = 'block';
            } else {
                nameField.style.display = 'none';
                nameField.value = '';
            }
        }
    </script>
</head>
<body>
    <h1>‚òï Barista Order Dashboard</h1>

    <form method="POST" action="/">
        <label>Last 4-digit Unique ID:</label><br>
        <input type="text" name="unique_id" id="unique_id" required oninput="fetchCustomerNames()" maxlength="4"><br><br>

        <label>Customer Name:</label><br>
        <select id="name_dropdown" name="customer_name" style="display:none;" onchange="toggleNameInput()"></select>
        <input type="text" name="custom_name" id="custom_name" placeholder="Enter customer name" required><br><br>

        <label>Phone (optional):</label><br>
        <input type="text" name="phone" placeholder="e.g. 0123456789"><br><br>

        <label>Drink Type:</label><br>
        <select name="drink_type">
            <option value="">N/A</option>
            <option value="Latte">Latte</option>
            <option value="Cappuccino">Cappuccino</option>
            <option value="Mocha">Mocha</option>
            <option value="Espresso">Espresso</option>
        </select><br><br>

        <label>Quantity:</label><br>
        <input type="number" name="quantity" value="0" min="0"><br><br>

        <button type="submit">Submit Order</button>
    </form>

    {% if message %}
        <p style="color:green;"><strong>{{ message }}</strong></p>
    {% endif %}

    {% if customers %}
        <h2>Customer Summary</h2>
        <table border="1">
            <tr>
                <th>Customer Name</th>
                <th>Unique ID</th>
                <th>Total Orders</th>
                <th>Token Earned</th>
                <th>Token Redeemed</th>
            </tr>
            {% for cust in customers %}
            <tr>
                <td>{{ cust[0] }}</td>
                <td>{{ cust[1] }}</td>
                <td>{{ cust[2] }}</td>
                <td>{{ cust[3] }}</td>
                <td>{{ cust[4] }}</td>
            </tr>
            {% endfor %}
        </table>
    {% endif %}

    <br><br>
    <a href="/export"><button>üìÅ Export to Excel</button></a>
</body>
</html>
