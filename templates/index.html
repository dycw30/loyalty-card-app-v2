<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Barista Order Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>‚òï Barista Order Dashboard</h1>
        <form method="POST">
            <label>Unique ID (last 4 of phone):</label>
            <input type="text" name="unique_id" id="unique_id" value="{{ request.form.unique_id or '' }}" required oninput="filterNames()">

            <label>Customer Name:</label>
            <select name="name" id="name">
                {% if names %}
                    {% for n in names %}
                        <option value="{{ n }}">{{ n }}</option>
                    {% endfor %}
                {% else %}
                    <option value="">Select or type manually</option>
                {% endif %}
            </select>

            <label>Phone (optional):</label>
            <input type="text" name="phone">

            <label>Drink:</label>
            <select name="drink">
                {% for d in drinks %}
                    <option value="{{ d }}">{{ d }}</option>
                {% endfor %}
            </select>

            <label>Today's Order Quantity:</label>
            <input type="number" name="quantity" min="0">

            <label>Redeem Tokens:</label>
            <input type="number" name="redeemed" min="0">

            <button type="submit">Submit Order</button>
        </form>

        {% if message %}
            <p class="message">{{ message }}</p>
        {% endif %}

        {% if summary %}
        <div class="summary-panel">
            <h3>Summary for {{ summary.customer_name }} (ID: {{ summary.unique_id }})</h3>
            <p>Total Orders: {{ summary.total_orders }}</p>
            <p>Tokens Earned: {{ summary.tokens }}</p>
            <p>Tokens Redeemed: {{ summary.redeemed }}</p>
            <p><strong>Token Balance: {{ summary.tokens - summary.redeemed }}</strong></p>
        </div>
        {% endif %}

        <h2>üìä Customer Totals</h2>
        <table>
            <thead>
                <tr>
                    <th>Unique ID</th>
                    <th>Name</th>
                    <th>Total Orders</th>
                    <th>Tokens</th>
                    <th>Redeemed</th>
                    <th>Balance</th>
                </tr>
            </thead>
            <tbody>
                {% for row in totals %}
                <tr>
                    <td>{{ row[0] }}</td>
                    <td>{{ row[1] }}</td>
                    <td>{{ row[2] }}</td>
                    <td>{{ row[3] }}</td>
                    <td>{{ row[4] }}</td>
                    <td>{{ row[3] - row[4] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="nav-links">
            <a href="/logout">üö™ Logout</a> |
            <a href="/lookup">üîç Customer Lookup</a> |
            <a href="/export">‚¨áÔ∏è Export Excel</a>
        </div>
    </div>

    <script>
        const nameMap = {{ name_map | safe }};
        function filterNames() {
            const uid = document.getElementById("unique_id").value;
            const dropdown = document.getElementById("name");
            dropdown.innerHTML = "";

            if (uid in nameMap) {
                nameMap[uid].forEach(n => {
                    const option = document.createElement("option");
                    option.value = n;
                    option.text = n;
                    dropdown.add(option);
                });
            } else {
                const defaultOption = document.createElement("option");
                defaultOption.text = "Select or type manually";
                defaultOption.value = "";
                dropdown.add(defaultOption);
            }
        }
    </script>
</body>
</html>
