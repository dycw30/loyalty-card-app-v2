<!DOCTYPE html>
<html>
<head>
    <title>Loyalty Card - Barista Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2 { color: #4CAF50; }
        input, select { padding: 6px; margin: 5px 0; width: 220px; }
        button { padding: 8px 16px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        a.export-link { float: right; margin-top: -40px; }
    </style>
</head>
<body>
    <h1>Barista Dashboard</h1>
    <a href="{{ url_for('export') }}" class="export-link">Download Excel Report</a>

    {% if message %}
        <p style="color: green;">{{ message }}</p>
    {% endif %}

    <form method="post">
        <label>Unique ID:</label><br>
        <input type="text" name="unique_id" required><br>

        <label>Drink Type:</label><br>
        <select name="drink">
            {% for drink in drinks %}
                <option value="{{ drink }}">{{ drink }}</option>
            {% endfor %}
            <option value="">N/A</option>
        </select><br>

        <label>Quantity Ordered:</label><br>
        <input type="number" name="quantity" min="0" value="0"><br>

        <label>Tokens to Redeem:</label><br>
        <input type="number" name="redeem" min="0" value="0"><br><br>

        <button type="submit">Submit Order</button>
    </form>

    {% if summary %}
        <h2>Summary for {{ summary.unique_id }}</h2>
        <p>Total Orders: {{ summary.total_orders }}</p>
        <p>Tokens Earned: {{ summary.tokens_earned }}</p>
        <p>Tokens Redeemed: {{ summary.redeemed }}</p>
        <p>Balance: {{ summary.balance }}</p>

        <h3>Recent Orders</h3>
        <table>
            <tr><th>Date</th><th>Drink</th><th>Qty</th><th>Tokens</th><th>Redeemed</th></tr>
            {% for order in recent_orders %}
                <tr>
                    <td>{{ order.date }}</td>
                    <td>{{ order.drink_type }}</td>
                    <td>{{ order.quantity }}</td>
                    <td>{{ order.tokens }}</td>
                    <td>{{ order.redeemed }}</td>
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    <h2>All Customers Summary</h2>
    <table>
        <tr><th>Unique ID</th><th>Total Orders</th><th>Tokens Earned</th><th>Redeemed</th><th>Balance</th></tr>
        {% for row in all_summary %}
            <tr>
                <td>{{ row.unique_id }}</td>
                <td>{{ row.total_orders }}</td>
                <td>{{ row.tokens_earned }}</td>
                <td>{{ row.redeemed }}</td>
                <td>{{ row.balance }}</td>
            </tr>
        {% endfor %}
    </table>

    <a href="{{ url_for('logout') }}">Logout</a>
</body>
</html>
